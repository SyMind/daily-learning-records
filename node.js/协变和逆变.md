# 协变与逆变

## 形式定义

## 数组类型

## 函数类型

支持一等函数的语言具有函数类型。这些语言需要指明什么时候一个函数类型是另一个函数类型的子类型。

一般规则是：

S1 → S2 ≦ T1 → T2 当 T1 ≦ S1 且 S2 ≦ T2.

换句话说，类型构造符 → 对输入类型是逆变的而对输出类型是协变的。

## 面向对象中的继承

当一个子类重写一个超类的方法时，编译器必须检查重写方法是否具有正确的类型。虽然一些语言要求类型必须与超类相同，但允许重写方法有一个“更好的”类型也是类型安全的。

对于以下示例，假设 Cat 是 Animal 的子类：

```java
class AnimalShelter {
    Animal getAnimalForAdoption() {
        // ...
    }

    void putAnimal(Animal animal) {
        // ...
    }
}
```

### 返回值的协变

在允许协变返回值的语言中，子类可以重写 getAnimalForAdoption 方法来返回一个更具体的类型：

```java
class CatShelter extends AnimalShelter {
    Cat getAnimalForAdoption() {
        return new Chat();
    }
}
```

### 方法参数的逆变

类似地，子类重写的方法接收更宽泛的类型也是类型安全的：

```java
class CatShelter extends AnimalShelter {
    void putAnimal(Object animal) {
        // ...
    }
}
```


### 去除对参数类型协变的依赖

在有泛型的语言中，前面的例子可以用更类型安全的方式重写：

```C#
class Shelter<T extends Animal> {
    T getAnimalForAdoption() {

    }

    void putAnimal(T animal) {

    }
}
```

## 泛型类型
