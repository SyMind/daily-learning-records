# 安全HTTP

## 保护HTTP的安全

HTTPS 在 HTTP 下面提供了一个传输级的密码安全层——可以使用 SSL，也可以使用其后继者——传输层安全（Trasport Layer Security，TLS）。

## 数字加密

### 密码编制的机制与技巧

### 密码

密码学基于一种名为密码（cipher）的秘密代码。密码是一套编码方案——一种特殊的报文编码方式和一种稍后使用的相应解码方式的结合体。

### 密码机

### 使用了密钥的密码

### 数字密码

## 对称密钥加密技术

编码时使用的密钥值和解码时一样的加密算法被称为对称密钥加密技术。

### 密钥长度与枚举攻击

### 建立共享密钥

对称密钥加密技术的缺点之一就是发送者和接收者在互相对话之前，一定要有一个共享的保密密钥。

## 公开密钥加密技术

公开密钥加密技术没有为每对主机使用单独的加密/解密密钥，而是使用了两个非对称密钥：一个用来对主机报文编码，另一个用来对主机报文解码。编码密钥是众所周知的，但只有主机才知道私有的解码密钥。

### RSA

### 混合加密系统和会话密钥

## 数字签名

处理加/解密报文之外，还可以用加密系统对报文进行签名（sign），以说明时谁编写的报文，同时证明报文未被篡改过。这种技术被称为数字签名（digital signing）。

签名时加了密的校验和

数字签名是附加在报文上的特殊加密校验码，使用数字签名有以下两个好处。
* 签名可以证明是作者编写了这条报文。只有作者才会有最高机密的私有密钥，因此，只有作者才能计算出这些校验和。
* 签名可以防止报文被篡改。如果有恶意攻击者在报文传输过程中对其进行了修改，校验和就不再匹配了。

* 节点 A 将变长报文提取为定长的摘要。
* 节点 A 对摘要应用了一个“签名”函数，这个函数会将用户的私有密钥作为参数。因为只有用户才知道私有密钥，所以正确的签名函数会说明签名者就是其所有者。由于解码函数 D 中包含了用户的私有密钥，所以我们将其作为签名函数使用。
* 一旦计算出来签名，节点 A 就将其附加在报文的末尾，其将报文和签名都发送给 B。
* 在接收端，如果节点 B 需要确定报文确实是节点 A 写的，而且没有被篡改过，节点 B 就可以对签名进行检查。节点 B 接受经私有密钥扰乱的签名，并应用了使用公开密钥的反函数。如果拆包后的摘要与节点 B 自己的摘要版本不匹配，要么就是报文在传输过程中被篡改了，要么就是发送端没有节点 A 的私有密钥。

## 数字证书

### 证书的主要内容

### X.509 v3证书

使用的大多数证书都以一种标准格式——X.509 v3证书，来存储它们的消息。

### 用证书对服务器进行验证

服务器证书中包含很多字段，其中包括：

* Web 站点的名称和主机名；
* Web 站点的公开密钥；
* 签名颁发机构的名称；
* 来自签名颁发机构的签名。

浏览器收到证书时会对签名颁发机构进行检查。如果这个机构是个很有权威的公共签名机构，浏览器可能已经知道其公开密钥了。

## HTTP——细节介绍

### HTTPS概述

HTTPS 就是在安全的传输层上发送的 HTTP。

### HTTPS方案

如果 URL 的方案为 https，客户端就会打开一条到服务器端口 443 的连接，然后与服务器“握手”，以二进制格式与服务器交换一些 SSL 安全参数，附上加密的 HTTP 命令。

SSL 是个二进制协议，与 HTTP 完全不同。

### 建立安全传输

在发送已加密的 HTTP 报文之前，客户端和服务器要进行一个 SSL 握手，在这个握手过程中，它们要完成一下工作。

* 交换协议版本号；
* 选择一个两端都了解的密码；
* 对两端的身份进行认证；
* 生成临时的会话密钥，以便加密信道。

### 服务器证书

SSL 支持双向认证，将服务器证书来承载回客户端，再将客户端的证书送给服务器。而现在，浏览时并不经常使用客户端证书。大部分用户甚至都没有自己的客户端证书。服务器可以要求使用客户端证书，但是实际中很少出现这种情况。

另一方面，安全 HTTPS 事务总是要求使用服务器证书的。

### 站点证书的有效性

SSL 自身不要求用户检查 Web 服务器证书，但是大部分现代浏览器都会对证书进行简单的完整性检查，并为用户提供进一步彻查的手段。

* 日期检测

首先，浏览器检查证书的其实日期和结束日期，以确保证书仍然有效。

* 签名颁发者可信度检测

每个证书都是由某些证书颁发机构（CA）签发的，它们负责为服务器担保。

* 签名检测

一旦判定签名授权是可信的，浏览器就要对签名使用签名颁发机构的公开密钥，并将其与校验码进行比较，以查看证书的完整性。

* 站点身份检测

为防止服务器复制其他人的证书，或拦截其他人的流量，大部分浏览器都会试着去验证证书中的域名与它们所对话的域名是否匹配。
